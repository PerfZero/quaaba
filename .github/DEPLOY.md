# Инструкция по настройке GitHub Actions для автоматического деплоя

## Настройка секретов в GitHub

Для работы workflow необходимо добавить следующие секреты в настройках репозитория:

1. Перейдите в **Settings** → **Secrets and variables** → **Actions**
2. Нажмите **New repository secret** и добавьте:

### SERVER_HOST
IP-адрес или домен вашего сервера
```
85.198.103.39
```

### SERVER_USER
Имя пользователя для SSH подключения
```
root
```

### SERVER_SSH_KEY
Приватный SSH ключ для подключения к серверу

#### Как получить SSH ключ:

1. **Если у вас уже есть SSH ключ на локальной машине:**
   ```bash
   cat ~/.ssh/id_rsa
   ```
   Скопируйте весь вывод (включая `-----BEGIN OPENSSH PRIVATE KEY-----` и `-----END OPENSSH PRIVATE KEY-----`)

2. **Если ключа нет, создайте новый:**
   ```bash
   ssh-keygen -t rsa -b 4096 -C "github-actions"
   ```
   Затем скопируйте приватный ключ:
   ```bash
   cat ~/.ssh/id_rsa
   ```

3. **Добавьте публичный ключ на сервер:**
   ```bash
   ssh-copy-id root@85.198.103.39
   ```
   Или вручную:
   ```bash
   cat ~/.ssh/id_rsa.pub | ssh root@85.198.103.39 "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
   ```

## Как работает workflow

1. **Триггеры:**
   - Автоматически при пуше в ветку `main`
   - Вручную через **Actions** → **Deploy to Server** → **Run workflow**

2. **Процесс деплоя:**
   - Клонирует код из репозитория
   - Подключается к серверу по SSH
   - Обновляет код через `git pull`
   - Останавливает существующие контейнеры
   - Пересобирает и запускает контейнеры заново
   - Показывает статус контейнеров

## Проверка работы

После настройки секретов:

1. Сделайте любой коммит и запушьте в `main`
2. Перейдите в **Actions** в GitHub
3. Увидите запущенный workflow
4. После успешного выполнения проект будет обновлен на сервере

## Устранение проблем

### Ошибка подключения по SSH
- Проверьте правильность IP-адреса в `SERVER_HOST`
- Убедитесь, что публичный ключ добавлен на сервер
- Проверьте, что SSH доступен на порту 22

### Ошибка при выполнении команд
- Убедитесь, что на сервере установлены Docker и Docker Compose
- Проверьте права доступа к директории `/var/www/quaaba`
- Убедитесь, что пользователь имеет права на выполнение Docker команд

